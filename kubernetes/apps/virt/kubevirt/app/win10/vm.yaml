---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: win10
  namespace: virt
spec:
  interval: 30m
  chart:
    spec:
      chart: raw
      version: v0.3.2
      sourceRef:
        kind: HelmRepository
        name: dysnix
        namespace: flux-system
      interval: 30m
  install:
    createNamespace: true
    remediation:
      retries: 10
  upgrade:
    remediation:
      retries: 10
  dependsOn:
    - name: kubevirt
      namespace: virt
  values:
    resources:
      - apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: win10
          namespace: virt
        spec:
          runStrategy: Halted
          template:
            metadata:
              labels:
                kubevirt.io/os: win10
            spec:
              domain:
                devices:
                  disks:
                    - name: root
                      disk:
                        bus: virtio
                    - name: cdrom
                      cdrom:
                        bus: sata
                firmware:
                  uuid: 5d307ca9-b3ef-428c-8861-06e72d69f223
                resources: {}
                memory:
                  guest: 8Gi
              terminationGracePeriodSeconds: 0
              volumes:
                - name: root
                  persistentVolumeClaim:
                    claimName: win10-root
                - name: cdrom
                  persistentVolumeClaim:
                    claimName: win10cd-pvc
      - apiVersion: kubevirt.io/v1
        kind: VirtualMachineInstance
        metadata:
          labels:
            special: inelo
          name: inelo
        spec:
          domain:
            clock:
              timer:
                hpet:
                  present: false
                hyperv: {}
                pit:
                  tickPolicy: delay
                rtc:
                  tickPolicy: catchup
              utc: {}
            cpu:
              cores: 2
            devices:
              disks:
                - cdrom:
                    bus: sata
                    name: virtio
              interfaces:
                - masquerade: {}
                  model: e1000
                  name: default
              tpm: {}
            features:
              acpi: {}
              apic: {}
              hyperv:
                relaxed: {}
                spinlocks:
                  spinlocks: 8191
                vapic: {}
              smm: {}
            firmware:
              bootloader:
                efi:
                  secureBoot: true
              uuid: 5d307ca9-b3ef-428c-8861-06e72d69f223
            memory:
              guest: 8Gi
            resources: {}
          networks:
          - name: default
            pod: {}
          terminationGracePeriodSeconds: 0
          volumes:
          - name: root
            persistentVolumeClaim:
              claimName: win10-root
          - containerDisk:
              image: kubevirt/virtio-container-disk
              name: virtio
