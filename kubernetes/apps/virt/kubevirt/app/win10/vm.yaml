---
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: win10
  namespace: virt
spec:
  interval: 30m
  chart:
    spec:
      chart: raw
      version: v0.3.2
      sourceRef:
        kind: HelmRepository
        name: dysnix
        namespace: flux-system
      interval: 30m
  install:
    createNamespace: true
    remediation:
      retries: 10
  upgrade:
    remediation:
      retries: 10
  dependsOn:
    - name: kubevirt
      namespace: virt
  values:
    resources:
      - apiVersion: kubevirt.io/v1
        kind: VirtualMachine
        metadata:
          name: win10
          namespace: virt
        spec:
          runStrategy: Halted
          dataVolumeTemplates:
            - metadata:
                creationTimestamp: null
                name: win10iso-dv
              spec:
                storage:
                  accessModes:
                  - ReadWriteOnce
                  resources:
                    requests:
                      storage: 10Gi
                source:
                  http:
                    url: https://software.download.prss.microsoft.com/dbazure/Win10_22H2_EnglishInternational_x64v1.iso?t=b547b31b-32c4-4d59-bf9e-a05115d69d62&P1=1756137582&P2=601&P3=2&P4=gIF1atFGL%2fJFw5U3MX15YaPcTicvV76CVUvav%2bJU3vnVA0xG9pcSV3fHvcUvvIY9dOK07UdANr0UqwLUaK2A976kUqeXM8DrrilAWxa%2buo1IUBHzPPuhm%2bTG0VIKCR6OE9x1Hw349G5ph8LMepM2KJvsRvC7BUB0%2fiIO3%2bsGjVWXNc0goe3YipyvpuCHgPBTKgM5Z5QZOGsC6SodLqxa9oBuE8NvLW9rQ5nMX3dfdrlky5SwlMxfkKGGQCox6Xl0gBVNjjPnHTkIkcuaJmcV%2fL%2bcqDi0Y8O7xOsHNtzjMNo2ML9m33frszEwVbv7nm0N%2fSEcofmM%2f8CwVRbFjqi4Pw%3d%3d
          template:
            metadata:
              labels:
                kubevirt.io/os: win10
            spec:
              domain:
                devices:
                  disks:
                    - name: root
                      disk:
                        bus: virtio
                    - name: cdrom
                      cdrom:
                        bus: sata
                        name: win10iso
                firmware:
                  uuid: 5d307ca9-b3ef-428c-8861-06e72d69f223
                resources: {}
                memory:
                  guest: 8Gi
              terminationGracePeriodSeconds: 0
              volumes:
                - name: root
                  persistentVolumeClaim:
                    claimName: win10-root
                - dataVolume:
                    claimName: win10iso
      - apiVersion: kubevirt.io/v1
        kind: VirtualMachineInstance
        metadata:
          labels:
            special: inelo
          name: inelo
        spec:
          domain:
            clock:
              timer:
                hpet:
                  present: false
                hyperv: {}
                pit:
                  tickPolicy: delay
                rtc:
                  tickPolicy: catchup
              utc: {}
            cpu:
              cores: 2
            devices:
              disks:
                - cdrom:
                    bus: sata
                    name: virtio
              interfaces:
                - masquerade: {}
                  model: e1000
                  name: default
              tpm: {}
            features:
              acpi: {}
              apic: {}
              hyperv:
                relaxed: {}
                spinlocks:
                  spinlocks: 8191
                vapic: {}
              smm: {}
            firmware:
              bootloader:
                efi:
                  secureBoot: true
              uuid: 5d307ca9-b3ef-428c-8861-06e72d69f223
            memory:
              guest: 8Gi
            resources: {}
          networks:
          - name: default
            pod: {}
          terminationGracePeriodSeconds: 0
          volumes:
          - containerDisk:
              image: kubevirt/virtio-container-disk
              name: virtio
